#!/usr/bin/env bash
set -x
set -e

root=${ALGO:=$HOME/Code/algos}

if [[ "$1" == "gen" || "$2" == "gen" ]]; then
  cat "$root/gen.cc" > "gen.cc"
  subl gen.cc
elif [[ "$1" == "cpp" ]]; then
  shift
  for filepath in $*; do
    if test -d $filepath; then
      echo "==> Problem $filepath already exist."
      exit 1
    fi
    mkdir -p $filepath
    filename=$(basename "$filepath")
    ctime=$(date "+%Y-%m-%d %H:%M:%S")
    sed -e "s/\\\$NAME/$filename/g" \
        -e "s/\\\$DATE/$ctime/g" \
        "$root/template.cc" > $filepath/$filename.cc
    sed -e "s|\\\$TESTS|$filename|g" \
        -e "s|\\\$CMP|$filename|g" \
        -e "s|\\\$GEN|$filename|g" \
        "$root/Makefile" > $filepath/Makefile
    echo "==> Problem $filepath created."
    cd $filepath
    touch ./$filename.in
    subl ./$filename.in
    subl ./$filename.cc
    algo-make "test" $filename
  done
fi
